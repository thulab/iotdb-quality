# Accuracy

## 函数简介
本函数用于计算时间序列数据与理论取值的不一致的程度。将输入序列划分为若干个连续且不重叠的窗口，分别计算每一个窗口的准确性，并输出窗口第一个数据点的时间戳和窗口的准确性。

**函数名：** ACCURACY

**输入序列：** 支持多个输入序列，类型为 INT32 / INT64 / FLOAT / DOUBLE。

**参数：**

+ `constraints`：约束，它是一个包含标识符、数、运算符的字符串。其中标识符为一个`$`符号与一个整数i的组合，代表了第i列数据。数可以为整数或浮点数。运算符包含`+`, `-`, `*`, `/`, `(`, `)`, `==`，其中 `==`有且只能有一个。缺省情况下，约束为 `$1 == $2`。
+ `sizewindow`：窗口大小，它是一个大于0的整数。代表每一个窗口包含的数据点数目，最后一个窗口的数据点数目可能会不足。缺省情况下，全部输入数据都属于同一个窗口。
+ `timewindow`：窗口大小，它是一个有单位的正数。代表窗口的时间跨度，目前支持五种单位，分别是'ms'（毫秒）、's'（秒）、'm'（分钟）、'h'（小时）和'd'（天）。缺省情况下，全部输入数据都属于同一个窗口。


**输出序列：** 输出单个序列，类型为DOUBLE，其中每一个数据点的值的范围都是[0,1]。

**提示：** 只有当窗口内的数据点数目超过10时，才会进行准确性计算。否则，该窗口将被忽略，不做任何输出。

## 使用示例

### 参数缺省

在`constraints`参数缺省的情况下，约束为 `$1 = $2`。

在`sizewindow`与`timewindow`参数都缺省的情况下，本函数会把全部输入数据都作为同一个窗口计算准确性。

输入序列：
```
+-----------------------------+---------------+---------------+
|                         Time|root.test.d1.s1|root.test.d1.s2|
+-----------------------------+---------------+---------------+
|2020-01-01T00:00:20.000+08:00|          118.2|          118.2|
|2020-01-01T00:00:22.000+08:00|          120.3|          120.3|
|2020-01-01T00:00:24.000+08:00|          120.9|          122.0|
|2020-01-01T00:00:26.000+08:00|          124.1|          124.1|
|2020-01-01T00:00:28.000+08:00|          126.4|          126.4|
|2020-01-01T00:00:30.000+08:00|            NaN|          128.7|
+-----------------------------+---------------+---------------+
```

用于查询的SQL语句：

```sql
select accuracy(s1, s2) from root.test.d1 
												where time <= 2020-01-01 00:00:30
```

输出序列：

```
+-----------------------------+----------------------------------------------+
|                         Time|    accuracy(root.test.d1.s1, root.test.d1.s2)|
+-----------------------------+----------------------------------------------+
|2020-01-01T00:00:20.000+08:00|                            0.6666666666666667|
+-----------------------------+----------------------------------------------+
```



### 指定约束

在指定约束的情况下，本函数会将输入的多列数据按照约束计算准确性。

输入序列：

```
+-----------------------------+---------------+---------------+---------------+
|                         Time|root.test.d1.s1|root.test.d1.s2|root.test.d1.s3|
+-----------------------------+---------------+---------------+---------------+
|2020-01-01T00:00:20.000+08:00|            443|          575.9|         1018.9|
|2020-01-01T00:00:22.000+08:00|            440|          572.0|         1012.0|
|2020-01-01T00:00:24.000+08:00|            440|          572.0|         1012.0|
|2020-01-01T00:00:26.000+08:00|            440|          572.0|         1012.0|
|2020-01-01T00:00:28.000+08:00|            440|          572.0|         1012.0|
|2020-01-01T00:00:30.000+08:00|            440|          572.0|         1012.0|
|2020-01-01T00:00:32.000+08:00|            440|          572.0|         1012.0|
|2020-01-01T00:00:34.000+08:00|            439|          570.7|         1009.7|
|2020-01-01T00:00:36.000+08:00|            439|          570.7|         1009.7|
|2020-01-01T00:00:38.000+08:00|            442|          574.6|         1016.6|
|2020-01-01T00:00:40.000+08:00|            442|          574.6|         1016.6|
|2020-01-01T00:00:42.000+08:00|            442|          574.6|         1016.6|
|2020-01-01T00:00:44.000+08:00|            435|          565.5|         1000.5|
|2020-01-01T00:00:46.000+08:00|            435|          565.5|         1000.5|
|2020-01-01T00:00:48.000+08:00|            435|          565.5|         1000.5|
+-----------------------------+---------------+---------------+---------------+
```

用于查询的SQL语句：

```sql
select accuracy(s1, s2, s3, 'constraints'='$1 + $2 == $3') 
					from root.test.d1 where time <= 2020-01-01 00:00:48
```

输出序列

```
+-----------------------------+---------------------------------------------------------+
|                         Time|accuracy(root.test.d1.s1,root.test.d1.s2,root.test.d1.s3)|
+-----------------------------+---------------------------------------------------------+
|2020-01-01T00:00:02.000+08:00|                                                      1.0|
+-----------------------------+---------------------------------------------------------+
```




### 指定窗口大小

在指定窗口大小的情况下，本函数会把输入数据划分为若干个窗口计算准确性。

输入序列:
```
+-----------------------------+---------------+---------------+
|                         Time|root.test.d1.s1|root.test.d1.s2|
+-----------------------------+---------------+---------------+
|2020-01-01T00:00:02.000+08:00|          100.0|          100.0|
|2020-01-01T00:00:03.000+08:00|          101.0|          101.0|
|2020-01-01T00:00:04.000+08:00|          102.0|          102.0|
|2020-01-01T00:00:06.000+08:00|          104.0|          104.0|
|2020-01-01T00:00:08.000+08:00|          126.0|          106.0|
|2020-01-01T00:00:10.000+08:00|          108.0|          108.0|
|2020-01-01T00:00:14.000+08:00|          112.0|          112.0|
|2020-01-01T00:00:15.000+08:00|          113.0|          113.0|
|2020-01-01T00:00:16.000+08:00|          114.0|          114.0|
|2020-01-01T00:00:18.000+08:00|          116.0|          116.0|
|2020-01-01T00:00:20.000+08:00|          118.0|          118.0|
|2020-01-01T00:00:22.000+08:00|          120.0|          120.0|
|2020-01-01T00:00:26.000+08:00|          124.0|          124.0|
|2020-01-01T00:00:28.000+08:00|          126.0|          126.0|
|2020-01-01T00:00:30.000+08:00|            NaN|          126.0|
|2020-01-01T00:00:32.000+08:00|          130.0|          130.0|
|2020-01-01T00:00:34.000+08:00|          132.0|          132.0|
|2020-01-01T00:00:36.000+08:00|          134.0|          134.0|
|2020-01-01T00:00:38.000+08:00|          136.0|          136.0|
|2020-01-01T00:00:40.000+08:00|          138.0|          138.0|
|2020-01-01T00:00:42.000+08:00|          140.0|          140.0|
|2020-01-01T00:00:44.000+08:00|          142.0|          142.0|
|2020-01-01T00:00:46.000+08:00|          144.0|          144.0|
|2020-01-01T00:00:48.000+08:00|          146.0|          146.0|
|2020-01-01T00:00:50.000+08:00|          148.0|          148.0|
|2020-01-01T00:00:52.000+08:00|          150.0|          150.0|
|2020-01-01T00:00:54.000+08:00|          152.0|          152.0|
|2020-01-01T00:00:56.000+08:00|          154.0|          154.0|
|2020-01-01T00:00:58.000+08:00|          156.0|          156.0|
|2020-01-01T00:01:00.000+08:00|          158.0|          158.0|
+-----------------------------+---------------+---------------+
```

用于查询的SQL语句：

```sql
select accuracy(s1,s2,"sizewindow"="15") from root.test.d1 where time <= 2020-01-01 00:01:00
```
或
```sql
select accuracy(s1,s2,"timewindow"="10m") from root.test.d1 where time <= 2020-01-01 00:01:00
```
