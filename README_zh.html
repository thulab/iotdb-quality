<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TsClean-IoTDB | TsClean-IoTDB</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="TsClean in Apache IoTDB's UDFs, including data quality indicator calculation, value filling, value repairing">
    
    <link rel="preload" href="/tsclean-iotdb/assets/css/0.styles.2d16b17e.css" as="style"><link rel="preload" href="/tsclean-iotdb/assets/js/app.a0b22605.js" as="script"><link rel="preload" href="/tsclean-iotdb/assets/js/2.04f3f0db.js" as="script"><link rel="preload" href="/tsclean-iotdb/assets/js/10.a1c46ac1.js" as="script"><link rel="prefetch" href="/tsclean-iotdb/assets/js/3.57a806ae.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/4.82f5c7df.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/5.bad83ab8.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/6.296b3d01.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/7.36dbcfc9.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/8.93c5cf25.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/9.cf1592ef.js">
    <link rel="stylesheet" href="/tsclean-iotdb/assets/css/0.styles.2d16b17e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/tsclean-iotdb/" class="home-link router-link-active"><!----> <span class="site-name">TsClean-IoTDB</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/tsclean-iotdb/" class="nav-link">
  Document
</a></div><div class="nav-item"><a href="/tsclean-iotdb/error.html" class="nav-link">
  Download
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/tsclean-iotdb/" class="nav-link">
  Document
</a></div><div class="nav-item"><a href="/tsclean-iotdb/error.html" class="nav-link">
  Download
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/tsclean-iotdb/" aria-current="page" class="sidebar-link">TsClean-IoTDB</a></li><li><a href="/tsclean-iotdb/README_zh.html" aria-current="page" class="active sidebar-link">TsClean-IoTDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tsclean-iotdb/README_zh.html#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/tsclean-iotdb/README_zh.html#快速开始" class="sidebar-link">快速开始</a></li><li class="sidebar-sub-header"><a href="/tsclean-iotdb/README_zh.html#函数介绍" class="sidebar-link">函数介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tsclean-iotdb/README_zh.html#时序数据质量指标函数" class="sidebar-link">时序数据质量指标函数</a></li><li class="sidebar-sub-header"><a href="/tsclean-iotdb/README_zh.html#时序数据数值填补函数" class="sidebar-link">时序数据数值填补函数</a></li><li class="sidebar-sub-header"><a href="/tsclean-iotdb/README_zh.html#时序数据数值修复函数" class="sidebar-link">时序数据数值修复函数</a></li></ul></li><li class="sidebar-sub-header"><a href="/tsclean-iotdb/README_zh.html#函数实现" class="sidebar-link">函数实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tsclean-iotdb/README_zh.html#数据质量指标" class="sidebar-link">数据质量指标</a></li><li class="sidebar-sub-header"><a href="/tsclean-iotdb/README_zh.html#数据填补方法" class="sidebar-link">数据填补方法</a></li><li class="sidebar-sub-header"><a href="/tsclean-iotdb/README_zh.html#数据修复方法" class="sidebar-link">数据修复方法</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="tsclean-iotdb"><a href="#tsclean-iotdb" class="header-anchor">#</a> TsClean-IoTDB</h1> <p>语言：<a href="/tsclean-iotdb/" class="router-link-active">English</a> | 中文</p> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <p>TsClean数据质量系统由清华大学大数据系统软件国家工程实验室自行研发，是一款具有国际领先水平的软件。该系统着眼于数据质量，致力于为工业大数据的应用提供坚实基础。目前，该系统已经在多个工业场景中得到广泛应用，受到用户的一致好评。</p> <p>本项目基于<a href="https://github.com/apache/iotdb" target="_blank" rel="noopener noreferrer">Apache IoTDB<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的用户自定义函数(UDF)，实现了TsClean数据质量系统的一系列重要函数，包括时序数据的质量指标计算、数值填补、数值修复等。</p> <h2 id="快速开始"><a href="#快速开始" class="header-anchor">#</a> 快速开始</h2> <ol><li>将本项目及其依赖打包成jar包或直接<a href="proguard-target/udf-tsclean-0.1.0-jar-with-dependencies.jar">下载</a></li> <li>将jar包复制到IoTDB程序目录的<code>ext\udf</code>目录下</li> <li>在IoTDB中使用下面的SQL语句注册UDF</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">function</span> completeness <span class="token keyword">as</span> “cn<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>thu<span class="token punctuation">.</span>dquality<span class="token punctuation">.</span>udf<span class="token punctuation">.</span>UDTFCompleteness”
<span class="token keyword">create</span> <span class="token keyword">function</span> consistency <span class="token keyword">as</span> “cn<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>thu<span class="token punctuation">.</span>dquality<span class="token punctuation">.</span>udf<span class="token punctuation">.</span>UDTFConsistency”
<span class="token keyword">create</span> <span class="token keyword">function</span> timeliness <span class="token keyword">as</span> “cn<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>thu<span class="token punctuation">.</span>dquality<span class="token punctuation">.</span>udf<span class="token punctuation">.</span>UDTFTimeliness”
<span class="token keyword">create</span> <span class="token keyword">function</span> validity <span class="token keyword">as</span> “cn<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>thu<span class="token punctuation">.</span>dquality<span class="token punctuation">.</span>udf<span class="token punctuation">.</span>UDTFValidity”
<span class="token keyword">create</span> <span class="token keyword">function</span> previousfill <span class="token keyword">as</span> “cn<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>thu<span class="token punctuation">.</span>dquality<span class="token punctuation">.</span>udf<span class="token punctuation">.</span>UDTFPreviousFill”
<span class="token keyword">create</span> <span class="token keyword">function</span> linearfill <span class="token keyword">as</span> “cn<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>thu<span class="token punctuation">.</span>dquality<span class="token punctuation">.</span>udf<span class="token punctuation">.</span>UDTFLinearFill”
<span class="token keyword">create</span> <span class="token keyword">function</span> screenrepair <span class="token keyword">as</span> “cn<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>thu<span class="token punctuation">.</span>dquality<span class="token punctuation">.</span>udf<span class="token punctuation">.</span>UDTFScreenRepair”
<span class="token keyword">create</span> <span class="token keyword">function</span> lsgreedyrepair <span class="token keyword">as</span> “cn<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>thu<span class="token punctuation">.</span>dquality<span class="token punctuation">.</span>udf<span class="token punctuation">.</span>UDTFLsGreedyRepair”
</code></pre></div> <h2 id="函数介绍"><a href="#函数介绍" class="header-anchor">#</a> 函数介绍</h2> <h3 id="时序数据质量指标函数"><a href="#时序数据质量指标函数" class="header-anchor">#</a> 时序数据质量指标函数</h3> <p>对于时序数据的质量，我们制定了完整性、一致性、时效性、有效性四个指标来进行衡量。计算各个指标的UDF如下表：</p> <table><thead><tr><th style="text-align:center;">函数名</th> <th style="text-align:center;">输入序列类型</th> <th style="text-align:center;">属性参数</th> <th style="text-align:center;">输出序列类型</th> <th style="text-align:center;">功能描述</th></tr></thead> <tbody><tr><td style="text-align:center;">COMPLETENESS</td> <td style="text-align:center;">INT32 / INT64 / FLOAT / DOUBLE</td> <td style="text-align:center;"><code>window</code>：每一个窗口包含的数据点数目，最后一个窗口的数据点数目可能会不足。缺省情况下，全部输入数据都属于同一个窗口。</td> <td style="text-align:center;">DOUBLE</td> <td style="text-align:center;">将输入序列划分为若干个连续且不重叠的窗口，分别计算每一个窗口的完整性，并输出窗口第一个数据点的时间戳和窗口的完整性。</td></tr> <tr><td style="text-align:center;">CONSISTENCY</td> <td style="text-align:center;">INT32 / INT64 / FLOAT / DOUBLE</td> <td style="text-align:center;"><code>window</code>：每一个窗口包含的数据点数目，最后一个窗口的数据点数目可能会不足。缺省情况下，全部输入数据都属于同一个窗口。</td> <td style="text-align:center;">DOUBLE</td> <td style="text-align:center;">将输入序列划分为若干个连续且不重叠的窗口，分别计算每一个窗口的一致性，并输出窗口第一个数据点的时间戳和窗口的一致性。</td></tr> <tr><td style="text-align:center;">TIMELINESS</td> <td style="text-align:center;">INT32 / INT64 / FLOAT / DOUBLE</td> <td style="text-align:center;"><code>window</code>：每一个窗口包含的数据点数目，最后一个窗口的数据点数目可能会不足。缺省情况下，全部输入数据都属于同一个窗口。</td> <td style="text-align:center;">DOUBLE</td> <td style="text-align:center;">将输入序列划分为若干个连续且不重叠的窗口，分别计算每一个窗口的时效性，并输出窗口第一个数据点的时间戳和窗口的时效性。</td></tr> <tr><td style="text-align:center;">VALIDITY</td> <td style="text-align:center;">INT32 / INT64 / FLOAT / DOUBLE</td> <td style="text-align:center;"><code>window</code>：每一个窗口包含的数据点数目，最后一个窗口的数据点数目可能会不足。缺省情况下，全部输入数据都属于同一个窗口。</td> <td style="text-align:center;">DOUBLE</td> <td style="text-align:center;">将输入序列划分为若干个连续且不重叠的窗口，分别计算每一个窗口的有效性，并输出窗口第一个数据点的时间戳和窗口的有效性。</td></tr></tbody></table> <p>例如：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> s1<span class="token punctuation">,</span>completeness<span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span>consistency<span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span>timeliness<span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span>validity<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">30</span>
</code></pre></div><p>结果：</p> <div class="language- extra-class"><pre class="language-text"><code>+-----------------------------+---------------+-----------------------------+----------------------------+---------------------------+-------------------------+
|                         Time|root.test.d1.s1|completeness(root.test.d1.s1)|consistency(root.test.d1.s1)|timeliness(root.test.d1.s1)|validity(root.test.d1.s1)|
+-----------------------------+---------------+-----------------------------+----------------------------+---------------------------+-------------------------+
|2020-01-01T00:00:02.000+08:00|          100.0|                        0.875|          0.9333333333333333|         0.9333333333333333|       0.8833333333333333|
|2020-01-01T00:00:03.000+08:00|          101.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:04.000+08:00|          102.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:06.000+08:00|          104.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:08.000+08:00|          126.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:10.000+08:00|          108.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:14.000+08:00|          112.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:15.000+08:00|          113.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:16.000+08:00|          114.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:18.000+08:00|          116.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:20.000+08:00|          118.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:22.000+08:00|          120.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:26.000+08:00|          124.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:28.000+08:00|          126.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:30.000+08:00|            NaN|                         null|                        null|                       null|                     null|
+-----------------------------+---------------+-----------------------------+----------------------------+---------------------------+-------------------------+
Total line number = 15
It costs 0.212s
</code></pre></div><h3 id="时序数据数值填补函数"><a href="#时序数据数值填补函数" class="header-anchor">#</a> 时序数据数值填补函数</h3> <p>对于时序数据，我们设计了一系列数值填补方法。各方法的UDF如下表：</p> <table><thead><tr><th style="text-align:center;">函数名</th> <th style="text-align:center;">输入序列类型</th> <th style="text-align:center;">属性参数</th> <th style="text-align:center;">输出序列类型</th> <th style="text-align:center;">功能描述</th></tr></thead> <tbody><tr><td style="text-align:center;">PREVIOUSFILL</td> <td style="text-align:center;">FLOAT / DOUBLE</td> <td style="text-align:center;"><code>beforeRange</code>：只有当前一个非<code>NaN</code>数据点与当前数据点的时间差不超过该值时才会进行填补，否则仍为<code>NaN</code>。在缺省情况下为无穷大。</td> <td style="text-align:center;">与输入序列的实际类型一致</td> <td style="text-align:center;">将输入序列中的<code>NaN</code>填补为前一个非<code>NaN</code>数据点的值，输出填补后的新序列。</td></tr> <tr><td style="text-align:center;">LINEARFILL</td> <td style="text-align:center;">FLOAT / DOUBLE</td> <td style="text-align:center;"><code>beforeRange</code>：只有当前一个非<code>NaN</code>数据点与当前数据点的时间差不超过该值时才会进行填补，否则仍为<code>NaN</code>。在缺省情况下为无穷大。<br> <code>afterRange</code>：只有当后一个非<code>NaN</code>数据点与当前数据点的时间差不超过该值时才会进行填补，否则仍为<code>NaN</code>。在缺省情况下为无穷大。</td> <td style="text-align:center;">与输入序列的实际类型一致</td> <td style="text-align:center;">将输入序列中的<code>NaN</code>填补为前一个和后一个非<code>NaN</code>数据点线性插值的结果，输出填补后的新序列。</td></tr></tbody></table> <p>例如：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> s2<span class="token punctuation">,</span>previousfill<span class="token punctuation">(</span>s2<span class="token punctuation">,</span><span class="token string">&quot;beforeRange&quot;</span><span class="token operator">=</span><span class="token string">&quot;1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>linearfill<span class="token punctuation">(</span>s2<span class="token punctuation">,</span><span class="token string">&quot;beforeRange&quot;</span><span class="token operator">=</span><span class="token string">&quot;1000&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;afterRange&quot;</span><span class="token operator">=</span><span class="token string">&quot;1000&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">30</span>
</code></pre></div><p>结果：</p> <div class="language- extra-class"><pre class="language-text"><code>+-----------------------------+---------------+---------------------------------------------------+----------------------------------------------------------------------+
|                         Time|root.test.d1.s2|previousfill(root.test.d1.s2, &quot;beforeRange&quot;=&quot;1000&quot;)|linearfill(root.test.d1.s2, &quot;beforeRange&quot;=&quot;1000&quot;, &quot;afterRange&quot;=&quot;1000&quot;)|
+-----------------------------+---------------+---------------------------------------------------+----------------------------------------------------------------------+
|2020-01-01T00:00:00.000+08:00|            NaN|                                                NaN|                                                                   NaN|
|2020-01-01T00:00:01.000+08:00|          120.0|                                              120.0|                                                                 120.0|
|2020-01-01T00:00:02.000+08:00|          120.0|                                              120.0|                                                                 120.0|
|2020-01-01T00:00:04.000+08:00|            NaN|                                                NaN|                                                                   NaN|
|2020-01-01T00:00:05.000+08:00|          130.0|                                              130.0|                                                                 130.0|
|2020-01-01T00:00:06.000+08:00|            NaN|                                              130.0|                                                                 135.0|
|2020-01-01T00:00:07.000+08:00|          140.0|                                              140.0|                                                                 140.0|
+-----------------------------+---------------+---------------------------------------------------+----------------------------------------------------------------------+
Total line number = 7
It costs 0.421s
</code></pre></div><h3 id="时序数据数值修复函数"><a href="#时序数据数值修复函数" class="header-anchor">#</a> 时序数据数值修复函数</h3> <p>时序数据中可能存在一些数值异常点，我们设计了一系列数值修复方法对这些异常点进行修复。各方法的UDF如下表：</p> <table><thead><tr><th style="text-align:center;">函数名</th> <th style="text-align:center;">输入序列类型</th> <th style="text-align:center;">属性参数</th> <th style="text-align:center;">输出序列类型</th> <th style="text-align:center;">功能描述</th></tr></thead> <tbody><tr><td style="text-align:center;">SCREENREPAIR</td> <td style="text-align:center;">INT32 / INT64 / FLOAT / DOUBLE</td> <td style="text-align:center;"><code>minSpeed</code>：当速度小于该值时会被视作数值异常点加以修复。在缺省情况下为中位数减去三倍绝对中位差。<br> <code>maxSpeed</code>：当速度大于该值时会被视作数值异常点加以修复。在缺省情况下为中位数加上三倍绝对中位差。</td> <td style="text-align:center;">与输入序列的实际类型一致</td> <td style="text-align:center;">采用基于速度阈值的Screen方法对时间序列的数值进行修复，输出修复后的序列（<code>NaN</code>在修复之前会先进行线性插值填补）。</td></tr> <tr><td style="text-align:center;">LSGREEDYREPAIR</td> <td style="text-align:center;">INT32 / INT64 / FLOAT / DOUBLE</td> <td style="text-align:center;"><code>center</code>：对速度变化分布建立的高斯模型的中心。在缺省情况下为0。<br> <code>sigma</code>：对速度变化分布建立的高斯模型的标准差。在缺省情况下为绝对中位差。</td> <td style="text-align:center;">与输入序列的实际类型一致</td> <td style="text-align:center;">采用基于速度变化似然的LsGreedy方法对时间序列的数值进行修复，输出修复后的序列（<code>NaN</code>在修复之前会先进行线性插值填补）。</td></tr></tbody></table> <p>例如：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> s1<span class="token punctuation">,</span>screenrepair<span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span>lsgreedyrepair<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">30</span>
</code></pre></div><p>结果：</p> <div class="language- extra-class"><pre class="language-text"><code>+-----------------------------+---------------+-----------------------------+-------------------------------+
|                         Time|root.test.d1.s1|screenrepair(root.test.d1.s1)|lsgreedyrepair(root.test.d1.s1)|
+-----------------------------+---------------+-----------------------------+-------------------------------+
|2020-01-01T00:00:02.000+08:00|          100.0|                        100.0|                          100.0|
|2020-01-01T00:00:03.000+08:00|          101.0|                        101.0|                          101.0|
|2020-01-01T00:00:04.000+08:00|          102.0|                        102.0|                          102.0|
|2020-01-01T00:00:06.000+08:00|          104.0|                        104.0|                          104.0|
|2020-01-01T00:00:08.000+08:00|          126.0|                        106.0|                          106.0|
|2020-01-01T00:00:10.000+08:00|          108.0|                        108.0|                          108.0|
|2020-01-01T00:00:14.000+08:00|          112.0|                        112.0|                          112.0|
|2020-01-01T00:00:15.000+08:00|          113.0|                        113.0|                          113.0|
|2020-01-01T00:00:16.000+08:00|          114.0|                        114.0|                          114.0|
|2020-01-01T00:00:18.000+08:00|          116.0|                        116.0|                          116.0|
|2020-01-01T00:00:20.000+08:00|          118.0|                        118.0|                          118.0|
|2020-01-01T00:00:22.000+08:00|          120.0|                        120.0|                          120.0|
|2020-01-01T00:00:26.000+08:00|          124.0|                        124.0|                          124.0|
|2020-01-01T00:00:28.000+08:00|          126.0|                        126.0|                          126.0|
|2020-01-01T00:00:30.000+08:00|            NaN|                        128.0|                          128.0|
+-----------------------------+---------------+-----------------------------+-------------------------------+
Total line number = 15
It costs 0.766s
</code></pre></div><h2 id="函数实现"><a href="#函数实现" class="header-anchor">#</a> 函数实现</h2> <h3 id="数据质量指标"><a href="#数据质量指标" class="header-anchor">#</a> 数据质量指标</h3> <p>对于时序数据的质量，我们制定了如下四个指标来进行衡量，每一个指标都包含了一个或多个异常：</p> <table><thead><tr><th style="text-align:center;">完整性</th> <th style="text-align:center;">一致性</th> <th style="text-align:center;">时效性</th> <th style="text-align:center;">有效性</th></tr></thead> <tbody><tr><td style="text-align:center;">数据丢失异常</td> <td style="text-align:center;">过密点</td> <td style="text-align:center;">延迟点</td> <td style="text-align:center;">取值范围</td></tr> <tr><td style="text-align:center;">空值异常</td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;">取值变化范围</td></tr> <tr><td style="text-align:center;">特殊值异常</td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;">速度范围</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;">速度变化范围</td></tr></tbody></table> <p><strong>完整性</strong>采用如下的公式计算：</p> <p>Completeness = 1 - (N<sub>null</sub> + N<sub>special</sub> + N<sub>miss</sub>) / (N + N<sub>miss</sub>)</p> <p>其中，N是时间序列总的数据点数目，N<sub>null</sub>是时间序列中值为空的数据点数目，N<sub>special</sub>是时间序列中值为特殊值的数据点数目，N<sub>miss</sub>是时间序列中丢失的数据点数目。</p> <p><strong>一致性</strong>采用如下的公式计算：</p> <p>Consistency = 1 - N<sub>redundancy</sub> / N</p> <p>其中，N是时间序列总的数据点数目，N<sub>redundancy</sub>是时间序列中过密的数据点数目。</p> <p><strong>时效性</strong>采用如下的公式计算：</p> <p>Timeliness = 1 - N<sub>late</sub> / N</p> <p>其中，N是时间序列总的数据点数目，N<sub>late</sub>是时间序列中延迟的数据点数目。</p> <p><strong>有效性</strong>采用如下的公式计算：</p> <p>Validity = 1 - (N<sub>value</sub> + N<sub>variation</sub> + N<sub>speed</sub> + N<sub>speedchange</sub>) / (4 * N)</p> <p>其中，N是时间序列总的数据点数目，N<sub>value</sub>是违反取值范围约束的数据点数目，N<sub>variation</sub>是违反取值变化约束的数据点数目，N<sub>speed</sub>是违反速度约束的数据点数目，N<sub>speedchange</sub>是违反速度变化约束的数据点数目（同一个数据点可能违反多项约束）。</p> <p>基于原始数据value和它的时间戳time，可以计算它的变化variation、速度speed以及速度变化speedchange：</p> <p>variation<sub>i</sub> = value<sub>i+1</sub> - value<sub>i</sub></p> <p>speed<sub>i</sub> = (value<sub>i+1</sub> - value<sub>i</sub>) / (time<sub>i+1</sub> - time<sub>i</sub>)</p> <p>speedchange<sub>i</sub> = speed<sub>i+1</sub> - speed<sub>i</sub></p> <p>对序列x，当x<sub>i</sub>与其中位数的偏差超过了三倍绝对中位差（为了达到渐进正态性，乘上比例因子1.4826）时，称作违背约束，即</p> <p>abs(x<sub>i</sub> - mid(x)) &gt; 3 * mad(x)</p> <h3 id="数据填补方法"><a href="#数据填补方法" class="header-anchor">#</a> 数据填补方法</h3> <p>如果待填补的数据点的时间戳是t，前一个非<code>NaN</code>的数据点是(t<sub>1</sub>,v<sub>1</sub>)，后一个非<code>NaN</code>的数据点是(t<sub>2</sub>,v<sub>2</sub>)。那么，采用<strong>Previous</strong>方法进行填补的结果为：</p> <p>v = v<sub>1</sub></p> <p>采用<strong>Linear</strong>方法进行填补的结果为：</p> <p>v = v<sub>1</sub> + (t - t<sub>1</sub>) * (v<sub>2</sub> - v<sub>1</sub>) / (t<sub>2</sub> - t<sub>1</sub>)</p> <h3 id="数据修复方法"><a href="#数据修复方法" class="header-anchor">#</a> 数据修复方法</h3> <p><strong>Screen</strong>方法是一种基于速度阈值的修复方法。它的核心思想是，在修改尽可能少的数据点的前提下，使整个时间序列的速度都不超过阈值。由于考虑全局约束的算法复杂度过大，这里将约束放松到一个滑动窗口内，结合候选范围与中位原则确定合适的修复方案。具体算法参见<a href="https://dl.acm.org/doi/10.1145/2723372.2723730" target="_blank" rel="noopener noreferrer">SIGMOD'15-Screen<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <p><strong>LsGreedy</strong>方法是一种基于速度变化似然的修复方法。它的核心思想是，对速度变化分布进行建模，并找到使似然函数最大化的修复方案。一般地，模型可以被视作高斯模型。为了降低运算复杂度，这里采用贪心算法寻找较优的修复方案。减小速度变化与中心的偏移可以增大似然函数。利用大根堆维护序列的速度变化，找到与高斯分布中心偏移最大的，并对其进行调整，使其更加接近中心。当所有的速度变化与中心的偏移都小于3倍标准差时，贪心算法终止。具体算法参见<a href="https://dl.acm.org/doi/10.1145/2882903.2915233" target="_blank" rel="noopener noreferrer">SIGMOD'16-Sequential<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tsclean-iotdb/" class="prev router-link-active">
        TsClean-IoTDB
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/tsclean-iotdb/assets/js/app.a0b22605.js" defer></script><script src="/tsclean-iotdb/assets/js/2.04f3f0db.js" defer></script><script src="/tsclean-iotdb/assets/js/10.a1c46ac1.js" defer></script>
  </body>
</html>
