<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TsClean-IoTDB | TsClean-IoTDB</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="TsClean in Apache IoTDB's UDFs, including data quality indicator calculation, value filling, value repairing">
    
    <link rel="preload" href="/tsclean-iotdb/assets/css/0.styles.793859d5.css" as="style"><link rel="preload" href="/tsclean-iotdb/assets/js/app.b1646d88.js" as="script"><link rel="preload" href="/tsclean-iotdb/assets/js/3.b2ac8a72.js" as="script"><link rel="preload" href="/tsclean-iotdb/assets/js/13.3c08df03.js" as="script"><link rel="prefetch" href="/tsclean-iotdb/assets/js/10.d73e33b8.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/11.467f7d4f.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/12.ef22b0f5.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/14.41f7fccd.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/15.bda612e5.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/16.111b5e8e.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/17.e7caec62.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/18.5b844a78.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/19.de535b95.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/20.d75c3159.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/21.d6f55d46.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/22.55b993ec.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/23.b4a17c79.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/24.720d748f.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/25.0dc77d6a.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/26.7f2d5f45.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/27.8773406e.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/28.e66f7cff.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/29.555bcfc0.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/30.6fd6722d.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/31.f8213169.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/32.ff0962f3.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/33.ef985327.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/34.b90d9387.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/35.5fc934ea.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/36.fd361ef3.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/37.5463cb30.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/4.41f68a6c.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/5.ee3b3e39.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/6.f3a0ad01.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/7.2e6cb6ae.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/8.de6486d9.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/9.c9cfc2a3.js"><link rel="prefetch" href="/tsclean-iotdb/assets/js/vendors~docsearch.c6292dad.js">
    <link rel="stylesheet" href="/tsclean-iotdb/assets/css/0.styles.793859d5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/tsclean-iotdb/" aria-current="page" class="home-link router-link-exact-active router-link-active"><!----> <span class="site-name">TsClean-IoTDB</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/tsclean-iotdb/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Document
</a></div><div class="nav-item"><a href="/tsclean-iotdb/Download.html" class="nav-link">
  Download
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tsclean-iotdb/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/tsclean-iotdb/zh/" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/tsclean-iotdb/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Document
</a></div><div class="nav-item"><a href="/tsclean-iotdb/Download.html" class="nav-link">
  Download
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Languages" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Languages" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tsclean-iotdb/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/tsclean-iotdb/zh/" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/tsclean-iotdb/" aria-current="page" class="active sidebar-link">TsClean-IoTDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tsclean-iotdb/#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/tsclean-iotdb/#quick-start" class="sidebar-link">Quick Start</a></li><li class="sidebar-sub-header"><a href="/tsclean-iotdb/#introductions-of-functions" class="sidebar-link">Introductions of Functions</a></li><li class="sidebar-sub-header"><a href="/tsclean-iotdb/#implementations-of-functions" class="sidebar-link">Implementations of Functions</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Universal Function</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Data Quality Indicator</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Value Filling</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Value Repairing</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="tsclean-iotdb"><a href="#tsclean-iotdb" class="header-anchor">#</a> TsClean-IoTDB</h1> <p>Language: English | <a href="/tsclean-iotdb/README_zh.html">中文</a></p> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>TsClean is developed independently by the National Engineering Laboratory for Big Data Software, Tsinghua University. It is a data quality system of international advanced level. It focuses on data quality and provides a solid foundation for the application of industrial big data. It has been widely used in many industrial scenes and well received by users.</p> <p>This project is User Defined Functions (UDF) of <a href="https://github.com/apache/iotdb" target="_blank" rel="noopener noreferrer">Apache IoTDB<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. It implements many key functions of TsClean including data quality indicator calculation, value filling, value repairing, etc.</p> <h2 id="quick-start"><a href="#quick-start" class="header-anchor">#</a> Quick Start</h2> <ol><li>Package this project into a JAR with all of its dependencies or directly <a href="proguard-target/udf-tsclean-0.1.0-jar-with-dependencies.jar">download it</a>.</li> <li>Copy the JAR package to <code>ext\udf</code> under the directory of IoTDB server.</li> <li>Register the UDFs with the following SQL statements in IoTDB:</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">function</span> completeness <span class="token keyword">as</span> “cn<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>thu<span class="token punctuation">.</span>dquality<span class="token punctuation">.</span>udf<span class="token punctuation">.</span>UDTFCompleteness”
<span class="token keyword">create</span> <span class="token keyword">function</span> consistency <span class="token keyword">as</span> “cn<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>thu<span class="token punctuation">.</span>dquality<span class="token punctuation">.</span>udf<span class="token punctuation">.</span>UDTFConsistency”
<span class="token keyword">create</span> <span class="token keyword">function</span> timeliness <span class="token keyword">as</span> “cn<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>thu<span class="token punctuation">.</span>dquality<span class="token punctuation">.</span>udf<span class="token punctuation">.</span>UDTFTimeliness”
<span class="token keyword">create</span> <span class="token keyword">function</span> validity <span class="token keyword">as</span> “cn<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>thu<span class="token punctuation">.</span>dquality<span class="token punctuation">.</span>udf<span class="token punctuation">.</span>UDTFValidity”
<span class="token keyword">create</span> <span class="token keyword">function</span> previousfill <span class="token keyword">as</span> “cn<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>thu<span class="token punctuation">.</span>dquality<span class="token punctuation">.</span>udf<span class="token punctuation">.</span>UDTFPreviousFill”
<span class="token keyword">create</span> <span class="token keyword">function</span> linearfill <span class="token keyword">as</span> “cn<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>thu<span class="token punctuation">.</span>dquality<span class="token punctuation">.</span>udf<span class="token punctuation">.</span>UDTFLinearFill”
<span class="token keyword">create</span> <span class="token keyword">function</span> lsgreedyrepair <span class="token keyword">as</span> “cn<span class="token punctuation">.</span>edu<span class="token punctuation">.</span>thu<span class="token punctuation">.</span>dquality<span class="token punctuation">.</span>udf<span class="token punctuation">.</span>UDTFLsGreedyRepair”
</code></pre></div> <h2 id="introductions-of-functions"><a href="#introductions-of-functions" class="header-anchor">#</a> Introductions of Functions</h2> <h3 id="functions-about-data-quality-indicators"><a href="#functions-about-data-quality-indicators" class="header-anchor">#</a> Functions about data quality indicators</h3> <p>For time series, we develop 4 data quality indicators: completeness, consistency, timeliness and validity. The UDFs to calculate these indicators are as follows:</p> <table><thead><tr><th style="text-align:center;">Name</th> <th style="text-align:center;">Type of Input Series</th> <th style="text-align:center;">Parameters</th> <th style="text-align:center;">Type of Output Series</th> <th style="text-align:center;">Description</th></tr></thead> <tbody><tr><td style="text-align:center;">COMPLETENESS</td> <td style="text-align:center;">INT32 / INT64 / FLOAT / DOUBLE</td> <td style="text-align:center;"><code>window</code>: The number of data points in each window. The number of data points in the last window may be less than it. By default, all input data belongs to the same window.</td> <td style="text-align:center;">DOUBLE</td> <td style="text-align:center;">The input series are divided into several continuous and non overlapping windows. The timestamp of the first data point and the completeness of each window will be output.</td></tr> <tr><td style="text-align:center;">CONSISTENCY</td> <td style="text-align:center;">INT32 / INT64 / FLOAT / DOUBLE</td> <td style="text-align:center;"><code>window</code>: The number of data points in each window. The number of data points in the last window may be less than it. By default, all input data belongs to the same window.</td> <td style="text-align:center;">DOUBLE</td> <td style="text-align:center;">The input series are divided into several continuous and non overlapping windows. The timestamp of the first data point and the consistency of each window will be output.</td></tr> <tr><td style="text-align:center;">TIMELINESS</td> <td style="text-align:center;">INT32 / INT64 / FLOAT / DOUBLE</td> <td style="text-align:center;"><code>window</code>: The number of data points in each window. The number of data points in the last window may be less than it. By default, all input data belongs to the same window.</td> <td style="text-align:center;">DOUBLE</td> <td style="text-align:center;">The input series are divided into several continuous and non overlapping windows. The timestamp of the first data point and the timeliness of each window will be output.</td></tr> <tr><td style="text-align:center;">VALIDITY</td> <td style="text-align:center;">INT32 / INT64 / FLOAT / DOUBLE</td> <td style="text-align:center;"><code>window</code>: The number of data points in each window. The number of data points in the last window may be less than it. By default, all input data belongs to the same window.</td> <td style="text-align:center;">DOUBLE</td> <td style="text-align:center;">The input series are divided into several continuous and non overlapping windows. The timestamp of the first data point and the validity of each window will be output.</td></tr></tbody></table> <p>Example:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> s1<span class="token punctuation">,</span>completeness<span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span>consistency<span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span>timeliness<span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span>validity<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">30</span>
</code></pre></div><p>Result:</p> <div class="language- extra-class"><pre class="language-text"><code>+-----------------------------+---------------+-----------------------------+----------------------------+---------------------------+-------------------------+
|                         Time|root.test.d1.s1|completeness(root.test.d1.s1)|consistency(root.test.d1.s1)|timeliness(root.test.d1.s1)|validity(root.test.d1.s1)|
+-----------------------------+---------------+-----------------------------+----------------------------+---------------------------+-------------------------+
|2020-01-01T00:00:02.000+08:00|          100.0|                        0.875|          0.9333333333333333|         0.9333333333333333|       0.8833333333333333|
|2020-01-01T00:00:03.000+08:00|          101.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:04.000+08:00|          102.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:06.000+08:00|          104.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:08.000+08:00|          126.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:10.000+08:00|          108.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:14.000+08:00|          112.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:15.000+08:00|          113.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:16.000+08:00|          114.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:18.000+08:00|          116.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:20.000+08:00|          118.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:22.000+08:00|          120.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:26.000+08:00|          124.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:28.000+08:00|          126.0|                         null|                        null|                       null|                     null|
|2020-01-01T00:00:30.000+08:00|            NaN|                         null|                        null|                       null|                     null|
+-----------------------------+---------------+-----------------------------+----------------------------+---------------------------+-------------------------+
Total line number = 15
It costs 0.212s
</code></pre></div><h3 id="functions-about-value-filling"><a href="#functions-about-value-filling" class="header-anchor">#</a> Functions about value filling</h3> <p>We develop some value filling functions for time series. Their UDFs are as follows:</p> <table><thead><tr><th style="text-align:center;">Name</th> <th style="text-align:center;">Type of Input Series</th> <th style="text-align:center;">Parameters</th> <th style="text-align:center;">Type of Output Series</th> <th style="text-align:center;">Description</th></tr></thead> <tbody><tr><td style="text-align:center;">PREVIOUSFILL</td> <td style="text-align:center;">FLOAT / DOUBLE</td> <td style="text-align:center;"><code>beforeRange</code>: The valid range of filling method. Filling works when the time difference between previous non-<code>NaN</code> point and this point is not more than it. By default, it's infinity.</td> <td style="text-align:center;">Same type as the input series</td> <td style="text-align:center;">The <code>NaN</code> points in the input series will be filled with the value of the previous non-<code>NaN</code> point. The new series will be output.</td></tr> <tr><td style="text-align:center;">LINEARFILL</td> <td style="text-align:center;">FLOAT / DOUBLE</td> <td style="text-align:center;"><code>beforeRange</code>: The valid range of filling method. Filling works when the time difference between previous non-<code>NaN</code> point and this point is not more than it. By default, it's infinity.<br> <code>afterRange</code>: The valid range of filling method. Filling works when the time difference between next non-<code>NaN</code> point and this point is not more than it. By default, it's infinity.</td> <td style="text-align:center;">Same type as the input series</td> <td style="text-align:center;">The <code>NaN</code> points in the input series will be filled with the value of the previous and next non-<code>NaN</code> point by linear interpolation. The new series will be output.</td></tr></tbody></table> <p>Example:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> s2<span class="token punctuation">,</span>previousfill<span class="token punctuation">(</span>s2<span class="token punctuation">,</span><span class="token string">&quot;beforeRange&quot;</span><span class="token operator">=</span><span class="token string">&quot;1000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>linearfill<span class="token punctuation">(</span>s2<span class="token punctuation">,</span><span class="token string">&quot;beforeRange&quot;</span><span class="token operator">=</span><span class="token string">&quot;1000&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;afterRange&quot;</span><span class="token operator">=</span><span class="token string">&quot;1000&quot;</span><span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">30</span>
</code></pre></div><p>Result:</p> <div class="language- extra-class"><pre class="language-text"><code>+-----------------------------+---------------+---------------------------------------------------+----------------------------------------------------------------------+
|                         Time|root.test.d1.s2|previousfill(root.test.d1.s2, &quot;beforeRange&quot;=&quot;1000&quot;)|linearfill(root.test.d1.s2, &quot;beforeRange&quot;=&quot;1000&quot;, &quot;afterRange&quot;=&quot;1000&quot;)|
+-----------------------------+---------------+---------------------------------------------------+----------------------------------------------------------------------+
|2020-01-01T00:00:00.000+08:00|            NaN|                                                NaN|                                                                   NaN|
|2020-01-01T00:00:01.000+08:00|          120.0|                                              120.0|                                                                 120.0|
|2020-01-01T00:00:02.000+08:00|          120.0|                                              120.0|                                                                 120.0|
|2020-01-01T00:00:04.000+08:00|            NaN|                                                NaN|                                                                   NaN|
|2020-01-01T00:00:05.000+08:00|          130.0|                                              130.0|                                                                 130.0|
|2020-01-01T00:00:06.000+08:00|            NaN|                                              130.0|                                                                 135.0|
|2020-01-01T00:00:07.000+08:00|          140.0|                                              140.0|                                                                 140.0|
+-----------------------------+---------------+---------------------------------------------------+----------------------------------------------------------------------+
Total line number = 7
It costs 0.421s
</code></pre></div><h3 id="functions-about-value-repairing"><a href="#functions-about-value-repairing" class="header-anchor">#</a> Functions about value repairing</h3> <p>There may be some outliers in time series. We develop some value repairing functions to repair these outliers. Their UDFs are as follows:</p> <table><thead><tr><th style="text-align:center;">Name</th> <th style="text-align:center;">Type of Input Series</th> <th style="text-align:center;">Parameters</th> <th style="text-align:center;">Type of Output Series</th> <th style="text-align:center;">Description</th></tr></thead> <tbody><tr><td style="text-align:center;">SCREENREPAIR</td> <td style="text-align:center;">INT32 / INT64 / FLOAT / DOUBLE</td> <td style="text-align:center;"><code>minSpeed</code>: Speed threshold. Speeds below it will be regarded as outliers. By default, it is the median minus 3 times of median absolute deviation. <br> <code>maxSpeed</code>: Speed threshold. Speeds above it will be regarded as outliers. By default, it is the median plus 3 times of median absolute deviation.</td> <td style="text-align:center;">Same type as the input series</td> <td style="text-align:center;">The outliers will be repaired by Screen method based on speed constraints. The new series will be output. Before repairing, <code>NaN</code> will be filled with linear interpolation.</td></tr> <tr><td style="text-align:center;">LSGREEDYREPAIR</td> <td style="text-align:center;">INT32 / INT64 / FLOAT / DOUBLE</td> <td style="text-align:center;"><code>center</code>: Center of the Gaussian distribution of speed changes. By default, it is 0. <br> <code>sigma</code>: Standard deviation of the Gaussian distribution of speed changes. By default, it is the median absolute deviation.</td> <td style="text-align:center;">Same type as the input series</td> <td style="text-align:center;">The outliers will be repaired by LsGreedy method based on speed change likelihoods. The new series will be output. Before repairing, <code>NaN</code> will be filled with linear interpolation.</td></tr></tbody></table> <p>Example:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> s1<span class="token punctuation">,</span>screenrepair<span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">,</span>lsgreedyrepair<span class="token punctuation">(</span>s1<span class="token punctuation">)</span> <span class="token keyword">from</span> root<span class="token punctuation">.</span>test<span class="token punctuation">.</span>d1 <span class="token keyword">where</span> <span class="token keyword">time</span> <span class="token operator">&lt;=</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">30</span>
</code></pre></div><p>Result:</p> <div class="language- extra-class"><pre class="language-text"><code>+-----------------------------+---------------+-----------------------------+-------------------------------+
|                         Time|root.test.d1.s1|screenrepair(root.test.d1.s1)|lsgreedyrepair(root.test.d1.s1)|
+-----------------------------+---------------+-----------------------------+-------------------------------+
|2020-01-01T00:00:02.000+08:00|          100.0|                        100.0|                          100.0|
|2020-01-01T00:00:03.000+08:00|          101.0|                        101.0|                          101.0|
|2020-01-01T00:00:04.000+08:00|          102.0|                        102.0|                          102.0|
|2020-01-01T00:00:06.000+08:00|          104.0|                        104.0|                          104.0|
|2020-01-01T00:00:08.000+08:00|          126.0|                        106.0|                          106.0|
|2020-01-01T00:00:10.000+08:00|          108.0|                        108.0|                          108.0|
|2020-01-01T00:00:14.000+08:00|          112.0|                        112.0|                          112.0|
|2020-01-01T00:00:15.000+08:00|          113.0|                        113.0|                          113.0|
|2020-01-01T00:00:16.000+08:00|          114.0|                        114.0|                          114.0|
|2020-01-01T00:00:18.000+08:00|          116.0|                        116.0|                          116.0|
|2020-01-01T00:00:20.000+08:00|          118.0|                        118.0|                          118.0|
|2020-01-01T00:00:22.000+08:00|          120.0|                        120.0|                          120.0|
|2020-01-01T00:00:26.000+08:00|          124.0|                        124.0|                          124.0|
|2020-01-01T00:00:28.000+08:00|          126.0|                        126.0|                          126.0|
|2020-01-01T00:00:30.000+08:00|            NaN|                        128.0|                          128.0|
+-----------------------------+---------------+-----------------------------+-------------------------------+
Total line number = 15
It costs 0.766s
</code></pre></div><h2 id="implementations-of-functions"><a href="#implementations-of-functions" class="header-anchor">#</a> Implementations of Functions</h2> <h3 id="data-quality-indicators"><a href="#data-quality-indicators" class="header-anchor">#</a> Data quality indicators</h3> <p>For data quality of time series, we develop the following 4 indicators. Each indicator includes one or more exceptions:</p> <table><thead><tr><th style="text-align:center;">Completeness</th> <th style="text-align:center;">Consistency</th> <th style="text-align:center;">Timeliness</th> <th style="text-align:center;">Validity</th></tr></thead> <tbody><tr><td style="text-align:center;">Data miss exception</td> <td style="text-align:center;">Redundancy exception</td> <td style="text-align:center;">Late exception</td> <td style="text-align:center;">Value exception</td></tr> <tr><td style="text-align:center;">Null exception</td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;">Variation exception</td></tr> <tr><td style="text-align:center;">Special value exception</td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;">Speed exception</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;">Speed change exception</td></tr></tbody></table> <p><strong>Completeness</strong> is calculated as follows:</p> <p>Completeness = 1 - (N<sub>null</sub> + N<sub>special</sub> + N<sub>miss</sub>) / (N + N<sub>miss</sub>)</p> <p>where N is the total number of data points in time series, N<sub>null</sub> is the number of points with null value, N<sub>special</sub> is the number of points with specail value and N<sub>miss</sub> is the number of missing points.</p> <p><strong>Consistency</strong> is calculated as follows:</p> <p>Consistency = 1 - N<sub>redundancy</sub> / N</p> <p>where N is the total number of data points in time series and N<sub>redundancy</sub> is the number of redundant points.</p> <p><strong>Timeliness</strong> is calculated as follows:</p> <p>Timeliness = 1 - N<sub>late</sub> / N</p> <p>where N is the total number of data points in time series and N<sub>late</sub> is the number of late points.</p> <p><strong>Validity</strong> is calculated as follows:</p> <p>Validity = 1 - (N<sub>value</sub> + N<sub>variation</sub> + N<sub>speed</sub> + N<sub>speedchange</sub>) / (4 * N)</p> <p>where N is the total number of data points in time series, N<sub>value</sub> is the number of points breaking value constraint, N<sub>variation</sub> is the number of points breaking variation constraint, N<sub>speed</sub> is the number of points breaking speed constraint and N<sub>speedchange</sub> is the number of points breaking speed change constraint. Significantly, a single data point may break multiple constraints.</p> <p>Base on the original values and their timestamps, the variaiton, speed and speed change can be calculated as follows:</p> <p>variation<sub>i</sub> = value<sub>i+1</sub> - value<sub>i</sub></p> <p>speed<sub>i</sub> = (value<sub>i+1</sub> - value<sub>i</sub>) / (time<sub>i+1</sub> - time<sub>i</sub>)</p> <p>speedchange<sub>i</sub> = speed<sub>i+1</sub> - speed<sub>i</sub></p> <p>For series x, when the difference between x<sub>i</sub> and the median of x is more than 3 times of the median absolute deviation (MAD, a constant 1.4826 is multipled for asymptotic normality) of x, the constraint is broken, i.e.</p> <p>abs(x<sub>i</sub> - mid(x)) &gt; 3 * mad(x)</p> <h3 id="data-filling-methods"><a href="#data-filling-methods" class="header-anchor">#</a> Data filling methods</h3> <p>Suppose the timestamp of the data point is t and the previous and next non-<code>NaN</code> data points are (t<sub>1</sub>,v<sub>1</sub>) and (t<sub>2</sub>,v<sub>2</sub>) respectively.
Thus, filling with <strong>Previous</strong> method, the value is</p> <p>v = v<sub>1</sub></p> <p>Filling with <strong>Linear</strong> method, the value is</p> <p>v = v<sub>1</sub> + (t - t<sub>1</sub>) * (v<sub>2</sub> - v<sub>1</sub>) / (t<sub>2</sub> - t<sub>1</sub>)</p> <h3 id="data-repairing-methods"><a href="#data-repairing-methods" class="header-anchor">#</a> Data repairing methods</h3> <p><strong>Screen</strong> method is based on speed constraints. Its key idea is making the whole time series meet the speed constraints while repairing as few data points as possible.
Due to the complexity of glocal optimum, the constraints are relaxed into a sliding window with the combination of candidate range and median principle.
The detailed algorithm is shown in <a href="https://dl.acm.org/doi/10.1145/2723372.2723730" target="_blank" rel="noopener noreferrer">SIGMOD'15-Screen<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p><strong>LsGreedy</strong> method is based on speed change likelihoods. Its key idea is modeling the distribution of speed changes and maximizing the likelihood function.
Generally, the model is Gaussian. In order to reduce the computational complexity, a greedy algorithm is used.
Decreasing the difference between the speed change and the center is equal to increasing the likelihood function.
Kept in a max heap, the data point with the maximum speed change will be modified to make the speed change closer to the center.
The algorithm terminates when no speed change difference is larger than 3 times of standard deviation.
The detailed algorithm is shown in <a href="https://dl.acm.org/doi/10.1145/2882903.2915233" target="_blank" rel="noopener noreferrer">SIGMOD'16-Sequential<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/tsclean-iotdb/Universal/Histogram.html">
        Histogram
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/tsclean-iotdb/assets/js/app.b1646d88.js" defer></script><script src="/tsclean-iotdb/assets/js/3.b2ac8a72.js" defer></script><script src="/tsclean-iotdb/assets/js/13.3c08df03.js" defer></script>
  </body>
</html>
